\chapter{Process Control Engineering}
\label{Chapter:Controls}

There are two main goals in process control engineering:
\begin{enumerate*}
    \item Reference tracking, where a process variable is matched to a set-point which may be changed over time; and 
    \item Disturbance rejection, where the process variable is held to the set-point despite outside influence upsetting it;
\end{enumerate*}
This is usually achieved by a controller which detects the process variable using a sensor/transmitter and controls the process variable by manipulating an actuator. 

\section{Feedback}
\begin{figure}[h!]
    \centering
    \input{tikz/feedback}
    \caption[Feedback control loop]{Feedback control loop. The output ($PV$) is measured by the transducer ($H$) and compared to the set-point ($SP$). The controller ($C$) uses the actuator ($A$) to control the process ($P$) based on the error ($e$).}
    \label{fig:tikz_feedback}
\end{figure}

The most common type of controller is a feedback controller. Figure \ref{fig:tikz_feedback} shows a simple feedback control loop with a sensor/transmitter (\ie transducer), controller, and actuator working together to control a process. The controller takes action based on the `error' ($e$) between the set-point ($SP$) and process-variable ($PV$) (\ref{eqn:error}).

\begin{equation}\label{eqn:error}
    e(t) = PV(t) - SP(t)
\end{equation}

The action, or controller output ($u$) is often determined by a \acf{pid} equation (\ref{eqn:pid}), which considers the instantaneous, cumulative, and predictive error in determining the proper actuation \cite{Bequette}. This equation has three terms:
\begin{enumerate}
\item Proportional control term. The control output is manipulated in proportion to the error defined by the proportional gain constant ($K_P$). A high gain yields an aggressive controller that is prone to overshooting the set-point, while a low gain may result in steady-state offset.  
\item Integral control term, which considers the historical cumulative error (calculated by taking the time integral of the error) in an effort to eliminate steady-state offset that a P-Only controller may exhibit. As the process variable settles around the set-point, the cumulative error approaches a constant value and the effect of the integral controller diminishes.
\item Derivative control term, which estimates the time rate of change of the error to dampen overshoot. This mechanism, sometimes referred to as anticipatory control, slightly reduces the proportional response to the error when the error is changing rapidly. This results in reducing the peak overshoot. A wel tuned anticipatory gain can allow a more aggressive proportional gain to be used without the large overshoot.
\end{enumerate}

\begin{equation}\label{eqn:pid}
    u(t) 
    = \underbrace{K_P e(t)}_{\text{Proportional}} 
    + \underbrace{K_I \int_0^t e(t)dt}_{\text{Integral}} 
    + \underbrace{K_D \frac{de(t)}{dt}}_{\text{Derivative}}
\end{equation}

Instead of using three different gain constants, it is common for controllers to be tuned in terms of a single controller gain ($K_C$) plus two time constants: 
\begin{enumerate*}
    \item The integral time constant ($\tau_I$); and
    \item The derivative time constant ($\tau_D$);
\end{enumerate*}
In this case, \ref{eqn:pid} is rewritten as:
\begin{equation}\label{eqn:pid-tau}
    u(t) = K_C \left( e(t) + \tau_I^{-1} \int_0^t e(t)dt + \tau_D \frac{de(t)}{dt}\right)
\end{equation}

\section{Feedforward}
The term `Feedforward' can be used to refer to any element in the control block diagram that exists outside of the feedback loop. In process control, feedforward controllers are almost always implemented alongside, not instead of feedback controllers because a standalone feedforward controller is not guaranteed to reach the set-point.  

\subsection{Disturbance Feedforward}
\begin{figure}[h!]
    \centering
    \input{tikz/feedforward}
    \caption[Feedback control loop with disturbance feedforward]{Feedback control loop with disturbance feedforward. It is identical to Fig. \ref{fig:tikz_feedback} with the addition of a disturbance ($D$) which effects the process variable ($PV$) according to the disturbance dynamics ($P_D$), and is measured by the disturbance transducer ($H_D$). The signal from $H_D$ is sent to the disturbance feedforward controller ($C_D$) who's output ($u_D$) is combined with ($u$) to form the total control output ($u^*$).}
    \label{fig:tikz_feedforward}
\end{figure}

In many processes, the process variable is effected by phenomena other than the actuator. These other phenomena are defined as disturbances. A well-tuned feedback controller is capable of disturbance rejection, but only after the disturbance causes error. In some cases, a disturbance feedforward controller may be added to the feedback controller to cause the actuator to counteract the effect of the disturbance before it occurs \cite{Bequette}.

The most prevalent disturbances that would effect the power output of the core of a \acs{msnb} are the temperature reactivity feedback effect common to all nuclear reactors and the flow reactivity specific to natural circulation driven  liquid fueled \acsp{msr} \cite{CarterNumerical}. Temperature reactivity feedback is dominated by Doppler Broadening, where the microscopic radiative capture cross section resonance peaks of nuclides such as \U[238] are depressed to cover a wider epithermal neutron spectrum \cite{DH}. This results in a smaller core neutron population and less fission events, so there is a negative correlation between fuel temperature and fuel reactivity. Flow reactivity is driven by the advection of delayed neutron precursors. Not all fission neutrons are released promptly; sometimes an unstable nuclide which decays by neutron emission produced instead. These unstable nuclides are called delayed neutron precursors and have half-lives ranging from less than a second to over a minute \cite{Lamarsh}. Since the fuel in a \acs{msnb} is flowing, there is a statistical probability that a delayed neutron precursor may leave the core by advection before the neutron is emitted in a much less reactive part of the reactor. When the temperature differential between the thermal center of the core and primary heat exchanger is increased, so too does the natural circulation flow rate. This decreases the likelihood of delayed neutrons being emitted in the core, and negatively contributes to core reactivity. Devices meant to elongate the in-core flow path may minimize delayed neutron losses \cite{CarterPHD}.

Disturbance feedforward will not be utilized in the design of the controller outlined in this work. When the outlet temperature of the heat exchanger is decreased, it takes time for the cooler salt to reach the core. The disturbance transport delay is on the order of minutes. Contrastly, Doppler Broadening has a nearly instantaneous effect, so disturbance dynamics are on the order of milliseconds, governed by the mean neutron lifetime \cite{DH,Lamarsh}. The effect of control actuation are similarly prompt. Even with a temperature sensor just at the inlet of the core it would be nearly impossible to reliably predict the exact moment that control reactivity would be need to be inserted to counteract the temperature reactivity. 

\subsection{Pre-Filter}
\begin{figure}[h!]
    \centering
    \input{tikz/prefilter}
    \caption[Feedback control loop with pre-filter]{Feedback control loop with pre-filter. It is identical to Fig. \ref{fig:tikz_feedback} with the addition of the pre-filter ($F$) which reshapes changes to the set-point ($SP$) before calculating the error ($e$).}
    \label{fig:tikz_prefilter}
\end{figure}

The control loop for a feedback system with a pre-filter is included as Figure \ref{fig:tikz_prefilter}. Pre-filters are another type of feedforward mechanism common in control systems. They are typically first-order transfer functions such as \ref{eqn:prefilter} function used to improve the performance of the associated feedback controller (as depicted by Figure \ref{fig:pgf_prefilter}) by `slowing down' the rate of change of the set-point. The gain (numerator) for a pre-filter is always unity because the desire is only to reshape the input, not resize it. The time-constant ($\tau_F$) describes how quickly the output equilibrates with the input. 

\begin{equation}\label{eqn:prefilter}
    F(s)=\frac{1}{\tau_F s+1}    
\end{equation}

By resisting instantaneous set-point changes, or step functions, the pre-filter minimizes the instantaneous error during transients and minimizes overshoot by reducing over-actuation or actuator saturation.  This is particularly useful in a control system such as the one designed in this report where the set-point is coupled to some other value. In this case, the core power generation needs to match the demand of the secondary system (\eg power cycle). This method allows the secondary system to immediately change to its necessary value while giving the reactor core time to safely and effectively respond. 

\begin{figure}[h!]
    \centering
    \subfloat[\centering Step-function]{{\resizebox{0.47\textwidth}{!}{\input{pgf/prefilter_step}}}}
    \qquad
    \subfloat[\centering Ramp-function]{\resizebox{0.47\textwidth}{!}{\input{pgf/prefilter_ramp}}}
    \caption[Pre-filter on (a) step-function and (b) ramp-function]{Pre-filter on step-function and ramp-function. When the pre-filter acts on a step-function, it follows an exponential curve, reaching 63.2\% of the magnitude of the step in 1 time constant, 86.5\% in 2 time constants, 95.0\% in 3 time constants and so on. The ramp-function exhibits similar but more complicated dynamics due to the changing input.}
    \label{fig:pgf_prefilter}
\end{figure}

\section{Transport Delay Problem}\note{Discussing the transport of cold salt and how it effects the global (flow) and local (temperature) feedback mechanism. Why we want to use a pre-filter and an actuation threshold of sorts.}

\section{Time-Variance and Non-Linearity}\note{Control Drum Angle vs. Reactivity Curve - non-linearity, Fissile depletion - time variance, the fact that we are actually controlling the criticality and not the power directly - ??}
In control systems, it is typically preferred to work with \acf{lti} systems

Fissile depletion - time function parameters or look-up table to gain-schedule and turn the time variant system into a shift invariant system.

In addition to the relatively slow time variance of fissile fuel depletion during steady-state critical operation, there are specific times in a \acs{msnb}'s expected operational life-cycle that exhibit a higher degree of time variance: 
\begin{enumerate*}
\item Start-up; \item Shut-down; and \item Re-start.
\end{enumerate*}

\subsection{Start-up}
Because microreactors are meant to be delivered in a fully or mostly assembled state, it is likely that the \acs{msnb} will be shipped with the molten fuel/coolant salt mixture frozen \textit{in-situ}. The salt will need to be melted before initial start-up, and the heat source for melting the cannot be fission, as the \acs{msnb} requires advective heat removal caused by natural circulation; this is not possible if the flow channels between the core and heat exchanger are frozen. One possible method for salt thawing involves passing low-voltage high-current electricity through the pipes in contact with the salt, similar to how frozen water pipes are thawed \cite{Thawing};

Initial start-up will also require a neutron source as a seed for the nuclear chain reaction \cite{DH}. \U[235] undergoes spontaneous fission \cite{Faw}, and at high enrichment may be used as the only neutron seed simply by putting the control actuators in a supercritical orientation. More commonly, a dedicated source is used, such as \Ca[252], which undergoes spontaneous fission much more rapidly, or a composite of a strong alpha-emitter (\eg \Pu[238], \Am[241], \Po[210], or \Ra[226]) and \Be[9] which emits a neutron according to \ref{rxn:Be-n} \cite{Handbook}.

\begin{reaction}\label{rxn:Be-n}
    ^{9}Be + \alpha \to ^{12}C + n + \gamma
\end{reaction}

Each of these systems are important considerations for the design of the \acs{msnb} and warrant further investigation, but are out of scope for this work. The main start-up consideration regarding the control system is the build-up of fission product neutron poisons.

\subsubsection{Xenon Poisoning}
\Xe is the strongest known neutron poison, with a microscopic neutron capture cross-section of 2.65 Mb \cite{Lamarsh}. The concentration of \Xe is described by a system of differential equations which quantifies the generation, consumption, and decay of itself and its beta-precursor \I. Equations \ref{eqn:diffI} and \ref{eqn:diffXe} can be used to track the concentrations of iodine-135 and xenon-135 during start-up, steady-state operation, power transients, shut-down, and dead-time \cite{Lamarsh}.
\begin{equation}\label{eqn:diffI}
    \frac{dI}{dt} =
    \underbrace{\gamma_{I}\Sigma_{f}^{F}{\phi}(t)}_{\text{Fission Yield}}
    -\underbrace{\lambda_{I}I(t)}_{\text{Beta Decay}}
\end{equation}
\begin{equation}\label{eqn:diffXe}
        \frac{dXe}{dt} =
        \underbrace{\gamma_{Xe}\Sigma_{f}^{F}{\phi}(t)}_{\text{Fission Yield}}
        +
        \underbrace{\lambda_{I}I(t)}_{\text{Precursor Decay}}
        -
        \underbrace{\lambda_{Xe}Xe(t)}_{\text{Beta Decay}}
        -
        \underbrace{Xe(t)\sigma_{a}^{Xe}{\phi}(t)}_{\text{Radiative Capture}}
\end{equation}

Each nuclide is formed by \U[235] fission, and removed by beta-decay. Additionally, \Xe is formed by the beta-decay of \I and removed by radiative neutron capture \footnotemark. Each nuclide builds-up in the reactor until the formation terms, i.e. fission yield and precursor decay, equilibrate with the removal terms, beta decay and radiative capture. By setting the time derivatives to zero, the neutron flux dependent equilibrium concentrations (\ref{eqn:eqI} and \ref{eqn:eqXe}) may be derived algebraically \cite{Lamarsh} and can contribute over 2000 pcm of negative poison reactivity to the core. 

\footnotetext{In reality, the decay chain is a bit more complicated than this. $^{135}Te$, the direct beta-precursor to \I is formed by \U[235] fission \cite{Roberson}. It's half-life is orders of magnitude shorter than \I, so it is common to neglect its formation and instead lump its fission yield with \I. \Xe[135m] is also formed by \I beta-decay and is neglected for similar reasons.}
 
\begin{equation}\label{eqn:eqI}
    I_{\infty}(\phi) = \frac{\gamma_I \Sigma_f^F }{\lambda_I}\phi
\end{equation}
\begin{equation}\label{eqn:eqXe}
    Xe_{\infty}(\phi) = \frac{(\gamma_I+\gamma_{Xe}) \Sigma_f^F }{\lambda_I+\sigma_a^{Xe}\phi}\phi
\end{equation}

\subsubsection{Samarium Poisoning}


\subsubsection{Burnable Poison Control}


\subsection{Shut-down}
Planned shut-down, either for scheduled maintenance or due to a lack of demand, is quite simple. The heat exchanger load is brought to zero or very low power, and the core set-point gradually follows. Careful selection of the pre-filter time constant can alleviate potential thermal hydraulic(\eg stagnation or reverse-flow) and thermophysical (\eg salt precipitation, freezing, or vaporization) concerns \cite{CarterNumerical}. The emergency shutdown (\ie SCRAM) system must be passive. In \acsp{lwr}, this is achieved by including large control rods which are actively held out of the core, so that a loss of power results in automatic insertion. Larger \acs{msr} designs may include a SCRAM tank into which the fuel/coolant salt drains in the event of power failure. These systems are often actuated by a freeze plug \cite{FreezePlug} and put the salt in a subcritical orientation by the inclusion of neutron control materials \cite{Charit} and high geometric buckling \cite{Lamarsh}.

Decay heat and keeping the salt liquid for restart

\subsection{Re-start}
\Xe stripper


