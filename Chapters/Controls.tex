\chapter{Process Control Engineering}
\label{Chapter:Controls}

There are two main goals in process control engineering:
\begin{enumerate*}
    \item Reference tracking, where a process variable is matched to a set-point which may be changed over time; and 
    \item Disturbance rejection, where the process variable is held to the set-point despite outside influence upsetting it;
\end{enumerate*}
This is usually achieved by a controller which detects the process variable using a sensor/transmitter and controls the process variable by manipulating an actuator. 

\section{Feedback}
\begin{figure}[h!]
    \centering
    \input{tikz/feedback}
    \caption[Feedback control loop]{Feedback control loop. The output ($PV$) is measured by the transducer ($H$) and compared to the set-point ($SP$). The controller ($C$) uses the actuator ($A$) to control the process ($P$) based on the error ($e$).}
    \label{fig:tikz_feedback}
\end{figure}

The most common type of controller is a feedback controller. Figure \ref{fig:tikz_feedback} shows a simple feedback control loop with a sensor/transmitter (\ie transducer), controller, and actuator working together to control a process. The controller takes action based on the `error' ($e$) between the set-point ($SP$) and process-variable ($PV$) (\ref{eqn:error}).

\begin{equation}\label{eqn:error}
    e(t) = PV(t) - SP(t)
\end{equation}

The action, or controller output ($u$) is often determined by a \acf{pid} equation (\ref{eqn:pid}), which considers the instantaneous, cumulative, and predictive error in determining the proper actuation \cite{Bequette}. This equation has three terms:
\begin{enumerate}
\item Proportional control term. The control output is manipulated in proportion to the error defined by the proportional gain constant ($K_P$). A high gain yields an aggressive controller that is prone to overshooting the set-point, while a low gain may result in steady-state offset.  
\item Integral control term, which considers the historical cumulative error (calculated by taking the time integral of the error) in an effort to eliminate steady-state offset that a P-Only controller may exhibit. As the process variable settles around the set-point, the cumulative error approaches a constant value and the effect of the integral controller diminishes.
\item Derivative control term, which estimates the time rate of change of the error to dampen overshoot. This mechanism, sometimes referred to as anticipatory control, slightly reduces the proportional response to the error when the error is changing rapidly. This results in reducing the peak overshoot. A wel tuned anticipatory gain can allow a more aggressive proportional gain to be used without the large overshoot.
\end{enumerate}

\begin{equation}\label{eqn:pid}
    u(t) 
    = \underbrace{K_P e(t)}_{\text{Proportional}} 
    + \underbrace{K_I \int_0^t e(t)dt}_{\text{Integral}} 
    + \underbrace{K_D \frac{de(t)}{dt}}_{\text{Derivative}}
\end{equation}

Instead of using three different gain constants, it is common for controllers to be tuned in terms of a single controller gain ($K_C$) plus two time constants: 
\begin{enumerate*}
    \item The integral time constant ($\tau_I$); and
    \item The derivative time constant ($\tau_D$);
\end{enumerate*}
In this case, \ref{eqn:pid} is rewritten as:
\begin{equation}\label{eqn:pid-tau}
    u(t) = K_C \left( e(t) + \tau_I^{-1} \int_0^t e(t)dt + \tau_D \frac{de(t)}{dt}\right)
\end{equation}

\section{Feedforward}
The term `Feedforward' can be used to refer to any element in the control block diagram that exists outside of the feedback loop. In process control, feedforward controllers are almost always implemented alongside, not instead of feedback controllers because a standalone feedforward controller is not guaranteed to reach the set-point.  

\subsection{Disturbance Feedforward}
\begin{figure}[h!]
    \centering
    \input{tikz/feedforward}
    \caption[Feedback control loop with disturbance feedforward]{Feedback control loop with disturbance feedforward. It is identical to Fig. \ref{fig:tikz_feedback} with the addition of a disturbance ($D$) which effects the process variable ($PV$) according to the disturbance dynamics ($P_D$), and is measured by the disturbance transducer ($H_D$). The signal from $H_D$ is sent to the disturbance feedforward controller ($C_D$) who's output ($u_D$) is combined with ($u$) to form the total control output ($u^*$).}
    \label{fig:tikz_feedforward}
\end{figure}

In many processes, the process variable is effected by phenomena other than the actuator. These other phenomena are defined as disturbances. A well-tuned feedback controller is capable of disturbance rejection, but only after the disturbance causes error. In some cases, a disturbance feedforward controller may be added to the feedback controller to cause the actuator to counteract the effect of the disturbance before it occurs \cite{Bequette}.

The most prevalent disturbances that would effect the power output of the core of a \acs{msnb} are the temperature reactivity feedback effect common to all nuclear reactors and the flow reactivity specific to natural circulation driven  liquid fueled \acsp{msr} \cite{CarterNumerical}. Temperature reactivity feedback is dominated by Doppler Broadening, where the microscopic radiative capture cross section resonance peaks of nuclides such as \U[238] are depressed to cover a wider epithermal neutron spectrum \cite{DH}. This results in a smaller core neutron population and less fission events, so there is a negative correlation between fuel temperature and fuel reactivity. Flow reactivity is driven by the advection of delayed neutron precursors. Not all fission neutrons are released promptly; sometimes an unstable nuclide which decays by neutron emission produced instead. These unstable nuclides are called delayed neutron precursors and have half-lives ranging from less than a second to over a minute \cite{Lamarsh}. Since the fuel in a \acs{msnb} is flowing, there is a statistical probability that a delayed neutron precursor may leave the core by advection before the neutron is emitted in a much less reactive part of the reactor. When the temperature differential between the thermal center of the core and primary heat exchanger is increased, so too does the natural circulation flow rate. This decreases the likelihood of delayed neutrons being emitted in the core, and negatively contributes to core reactivity. Devices meant to elongate the in-core flow path may minimize delayed neutron losses \cite{CarterPHD}.

Disturbance feedforward will not be utilized in the design of the controller outlined in this work. When the outlet temperature of the heat exchanger is decreased, it takes time for the cooler salt to reach the core. The disturbance transport delay is on the order of minutes. Contrastly, Doppler Broadening has a nearly instantaneous effect, so disturbance dynamics are on the order of milliseconds, governed by the mean neutron lifetime \cite{DH,Lamarsh}. The effect of control actuation are similarly prompt. Even with a temperature sensor just at the inlet of the core it would be nearly impossible to reliably predict the exact moment that control reactivity would be need to be inserted to counteract the temperature reactivity. 

\subsection{Pre-Filter}
\begin{figure}[h!]
    \centering
    \input{tikz/prefilter}
    \caption[Feedback control loop with pre-filter]{Feedback control loop with pre-filter. It is identical to Fig. \ref{fig:tikz_feedback} with the addition of the pre-filter ($F$) which reshapes changes to the set-point ($SP$) before calculating the error ($e$).}
    \label{fig:tikz_prefilter}
\end{figure}

Pre-filters are another type of feedforward mechanism common in control systems. They are typically first-order transfer functions such as \ref{eqn:prefilter} function used to improve the performance of the associated feedback controller (as depicted by Figure \ref{fig:tikz_prefilter} by `slowing down' the rate of change of the set-point. The gain (numerator) for a pre-filter is always unity because the desire is only to reshape the input, not resize it. The time-constant ($\tau_F$) describes how quickly the output equilibrates with the input. 

\begin{equation}\label{eqn:prefilter}
    F(s)=\frac{1}{\tau_F s+1}    
\end{equation}

By braking instantaneous set-point changes, or step functions, the pre-filter minimizes the instantaneous error during transients and minimizes overshoot by reducing over-actuation or actuator saturation.  This is particularly useful in a control system such as the one designed in this report where the set-point is coupled to some other value. In this case, the core power generation needs to match the demand of the secondary system (\eg power cycle). This method allows the secondary system to immediately change to its necessary value while giving the reactor core time to safely and effectively respond. 

\begin{figure}[h!]
    \centering
    \subfloat[\centering Step-function]{{\resizebox{0.47\textwidth}{!}{\input{pgf/prefilter_step}}}}
    \qquad
    \subfloat[\centering Ramp-function]{\resizebox{0.47\textwidth}{!}{\input{pgf/prefilter_ramp}}}
    \caption[Pre-filter on step-function and ramp-function]{Pre-filter on step-function and ramp-function.}
    \label{fig:pgf_prefilter}
\end{figure}

\section{Time Variance}
Fissile depletion - time function parameters or look-up table to gain-schedule and turn the time variant system into a shift invariant system.

In addition to the relatively slow time variance of fissile fuel depletion during steady-state critical operation, there are specific times in a \acs{msnb}'s expected operational life-cycle that exhibit a higher degree of time variance: 
\begin{enumerate*}
\item Start-up; \item Shut-down; and \item Re-start.
\end{enumerate*}

\subsection{Start-up}
Black-start may need to deal with thawing salt - main concern is fission product neutron poison build-up (discuss the burnable poison stuff)

\subsection{Shut-down}
Planned shut-down

Emergency Shutdown/SCRAM(must be passive)

Decay heat and keeping the salt liquid for restart

\subsection{Re-start}
\Xe stripper


